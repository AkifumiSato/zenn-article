---
title: "コンポーネント指向"
---

## 要約

Reactは**コンポーネント指向**なフレームワークであり、UIをページ単位ではなくコンポーネント単位で考えます。コンポーネント単位の設計は、**再利用性**と**関心の分離**の観点が特に重要です。

## 背景

Webは当初、ドキュメントの参照を目的に発展した技術^[参考: [World Wide Web - Wikipedia](https://ja.wikipedia.org/wiki/World_Wide_Web)]です。そのため、Webの基本的なアーキテクチャはURLに対応するドキュメントページを取得する、いわば**ページ指向**です。1つのHTMLファイルに対し、装飾するCSSや動的振る舞いを定義するJavaScriptを定義するというように、ページを中心としたアーキテクチャが基本となっています。

当初のドキュメント参照用途でのWebは非常にシンプルなものだったので、このアーキテクチャでも十分でした。しかし、Web技術の発展とアプリケーション需要の拡大により、開発者に対する要求は複雑化し、ページ単位でCSSやJSを考えなければならないことは大きなデメリットとなりました。

### ページ指向からコンポーネント指向へ

**コンポーネント指向**は、UI部品を組み合わせてページを構成するような設計思想です。コンポーネント指向なフレームワークでは、常にページ単位のスコープで考えなければならなかったCSSやJavaScriptの実装をコンポーネント単位で考えることができます。コンポーネントは独立性高く実装できるため、複数のページで共通利用するなど再利用性も向上します。

## 設計思想

Reactは**コンポーネント指向**なUIライブラリ^[Reactは[公式ドキュメント](https://ja.react.dev/)によるとライブラリであり、同時にアーキテクチャでもあります。]であり、コンポーネントを組み合わせてアプリケーションを構築します。

ReactコンポーネントはJSXやCSS modules/CSS in JSなどの技術によって、マークアップやスタイルもJavaScriptの一部として扱うことができます。

```jsx
import styles from "./my-button.module.css";

function MyButton({ children, onClick }) {
  return (
    <button className={styles.button} onClick={onClick}>
      {children}
    </button>
  );
}
```

ReactにおけるコンポーネントはJavaScript関数（もしくはClass）そのものであり、マークアップやスタイルを持たない振る舞いのみを持ったコンポーネントも存在します。コンポーネント指向の説明ではコンポーネントを「UI部品」と表現しましたが、Reactにおいては「UI部品」というより「部品」そのものだと考えるとわかりやすいかもしれません。

Reactにおいてコンポーネントの粒度や責務をどう設計するかは非常に重要です。筆者が特に重要だと考えるコンポーネント設計の観点は、**再利用性**と**関心の分離**です。

### 再利用性

複数個所で利用するUI単位は、コンポーネントとして定義すべきです。デザインシステムで一般的に提供されるようなatomicなコンポーネント^[参考: [MUIのComponents](https://mui.com/components/)]はもちろんのこと、複数箇所で使う大きなUI単位もコンポーネントとして定義することで、重複実装を排除することができます。

ただし、共通利用するコンポーネントの振る舞いはシンプルで予想可能な状態にする必要があります。複雑な振る舞いを持ったコンポーネントは利用者側にとって複雑なブラックボックスと化してしまい、負債になる場合があります。

### 関心の分離

Reactでは再利用が想定されない場合でも、**関心の分離**を目的にコンポーネントを分割することがあります。

右側にユーザーアイコンが表示されるような、よくあるヘッダーUIを例に考えてみます。

```tsx
function Header() {
  const { isLoggedIn, ...user } = useAuth();

  return (
    <header>
      <h1>My Awesome App</h1>
      {/* ...省略... */}
      {isLoggedIn ? (
        <div>{/* ログイン時 */}</div>
      ) : (
        <div>{/* 未ログイン時 */}</div>
      )}
    </header>
  );
}
```

スタイルに関する実装なども省略しているかなり簡易な例なので、実際にはもっと複雑な実装になることでしょう。現状`useAuth()`の結果を使ってるのは現状`<header>`の一部分のみです。このような場合、情報の参照単位でコンポーネントを分割することでコンポーネントの見通しが良くなります。ここでは仮に`UserMenu`コンポーネントとし、上記実装をリファクタしてみます。

```tsx
function Header() {
  return (
    <header>
      <h1>My Awesome App</h1>
      {/* ...省略... */}
      <UserMenu />
    </header>
  );
}
```

再利用は想定されずとも、データの参照範囲など関心ごとにコンポーネントを適切に分割することで、コンポーネントの可読性が向上することがあります。一方、過剰な分割は可読性を逆に悪化させる可能性もあるため、適切な粒度での分割が重要です。「適切な粒度」は、アプリケーション特性や開発者特性にもよるため、チーム内での合意形成が重要となります。

### コンポーネント単位とレンダリングの最適化

再利用性の向上と関心の分離以外にも、**レンダリングの最適化**を目的にコンポーネントを分割することがあります。Reactは状態の変化に応じてコンポーネントを再レンダリングしますが、ページ全体を再レンダリングするわけではありません。状態が変化したコンポーネントとその配下のコンポーネントのみを再レンダリングします。

![React Tree](/images/react-basic-principle/re-render-tree.png)

コンポーネントを分割することで、再レンダリングする範囲を最適化することが可能です。

## トレードオフ

### 曖昧な「コンポーネント」の意味

デザイナーにとってコンポーネントとは、atomicな**UIコンポーネント**を指すことが多く、システム的振る舞いを持たない場合も多いので用語の取り扱いには注意が必要です。

Reactにおいては、ページコンポーネントのように非常に大きなコンポーネントや、システム的振る舞いのみを定義したContainerコンポーネントやProviderコンポーネントなど、デザイン文脈では登場しないコンポーネントも多数存在します。

### コンポーネント間のやりとり

コンポーネントは高い独立性を持ちますが、呼び出し側から**Props**を渡すことで様々なカスタマイズ性を持ちます。

```tsx
<Button colorPalette="teal" variant="solid">
  <RiMailLine /> Email
</Button>
```

しかし、深い階層のコンポーネントが必要とするPropsを多くの中間コンポーネントを経由して渡し続けるような実装は、冗長な実装として*Props Drilling*（Propsのバケツリレー）と呼ばれるアンチパターンとなります。

```tsx
// `<Greeting>`で使う情報を`<Header>`から渡し続けているProps Drillingの様子
// header.tsx
<Header username={username} />

// user-card.tsx
<UserCard username={username} />

// greeting.tsx
<Greeting username={props.username} />
```

このような実装を避けるためにも、Reactでは[Context API](https://ja.react.dev/learn/passing-data-deeply-with-context)や、[jotai](https://jotai.org/)のような3rd partyライブラリを用いてコンポーネント間で情報を共有する仕組みを適宜利用する必要があります。

---
title: "コンポーネント指向"
---

## 要約

Reactは**コンポーネント指向**なフレームワークであり、UIをページ単位ではなくコンポーネント単位で考えます。コンポーネント単位の設計は、**再利用性**と**関心の分離**の観点が特に重要です。

## 背景

Webは当初、ドキュメントの相互参照を目的に発展した技術^[参考: [World Wide Web - Wikipedia](https://ja.wikipedia.org/wiki/World_Wide_Web)]で、非常にシンプルなものでした。ページ単位に対しCSSやJavaScriptで装飾や振る舞いを定義するのも、シンプルなWebにおいては有効な設計でした。しかし、Web技術の発展とアプリケーション需要の拡大により、開発者に対する要求は複雑化し、ページ単位でCSSやJSを考えなければならないことは大きなデメリットとなりました。

### コンポーネント指向の登場

**コンポーネント指向**は、UI部品を組み合わせてページを構成するような設計思想です。コンポーネント指向なフレームワークでは、ページ単位で考えなければならなかったCSSやJavaScriptを、コンポーネント単位で考えることができます。独立したコンポーネントは再利用も容易なため、複数のページで使いまわすこともできます。

## 設計思想

Reactはコンポーネント指向なUIライブラリ^[Reactは[公式ドキュメント](https://ja.react.dev/)によるとライブラリであり、同時にアーキテクチャでもあります。]であり、コンポーネントを組み合わせてアプリケーションを構築します。

ReactコンポーネントはJSXやCSS modules/CSS in JSなどの技術によって、マークアップやスタイルもJavaScriptの一部として扱うことができます。

```jsx
import styles from "./my-button.module.css";

function MyButton({ children, onClick }) {
  return (
    <button className={styles.button} onClick={onClick}>
      {children}
    </button>
  );
}
```

ReactにおけるコンポーネントはJavaScript関数（もしくはClass）そのものであり、振る舞いのみを持ちマークアップやスタイルを持たないコンポーネントも存在します。前述の説明ではコンポーネントを「UI部品」と表現しましたが、Reactにおいては「UI部品」というより「部品」そのものだと考えるとわかりやすいかもしれません。

Reactにおいてコンポーネントの粒度や責務をどう設計するかは非常に重要です。筆者が特に重要だと考えるコンポーネント設計の観点は、**再利用性**と**関心の分離**です。

### 再利用性

複数個所で利用するUI単位は、コンポーネントとして定義すべきです。デザインシステムで一般的に提供されるようなatomicなコンポーネント^[参考: [MUIのComponents](https://mui.com/components/)]はもちろんのこと、複数箇所で使う大きなUI単位もコンポーネントとして定義することで、重複実装を排除することができます。

ただし、共通利用するコンポーネントの振る舞いはシンプルで予想可能な状態にする必要があります。複雑な振る舞いを持ったコンポーネントは利用者側にとって悪い意味でブラックボックスと化してしまい、負債になる場合があります。

### 関心の分離

Reactでは再利用が想定されない場合でも、**関心の分離**を目的にコンポーネントを分割することがあります。

右側にユーザーアイコンが表示されるような、よくあるヘッダーUIを例に考えてみます。

```tsx
function Header() {
  const { isLoggedIn, user } = useAuth();

  return (
    <header>
      <h1>My App</h1>
      {/* ...省略... */}
      {isLoggedIn ? (
        <div>{/* ログイン時 */}</div>
      ) : (
        <div>{/* 未ログイン時 */}</div>
      )}
    </header>
  );
}
```

スタイルに関する実装なども省略しているかなり簡易な例なので、実際にはもっと複雑な実装になることでしょう。現状`useAuth()`の結果を使ってるのは`<header>`の一部分のみです。このような場合、情報の参照単位でコンポーネントを分割することでコンポーネントの見通しが良くなります。

`useAuth()`に依存する部分を`<UserMenu>`コンポーネントとして定義すると、`<Header>`コンポーネントは以下のようになります。

```tsx
function Header() {
  return (
    <header>
      <h1>My App</h1>
      {/* ...省略... */}
      <UserMenu />
    </header>
  );
}
```

このように再利用は想定されずとも、データの参照範囲などの関心ごとにコンポーネントを適切に分割することで、コンポーネントの可読性が向上する可能性があります。一方で、過剰な分割は可読性を悪化させるため、適切な粒度での分割が重要です。「適切な粒度」は、アプリケーション特性や開発者判断にもよるため、チーム内での合意形成が重要です。

### コンポーネント単位とレンダリングの最適化

応用的なテクニックとして、**レンダリングの最適化**を目的にコンポーネントを分割することがあります。Reactは状態の変化に応じてコンポーネントを再レンダリングしますが、ページ全体を再レンダリングするわけではありません。状態が変化したコンポーネントとその配下のコンポーネントのみを再レンダリングします。

![React Tree](/images/react-basic-principle/re-render-tree.png)

コンポーネントを分割することで、再レンダリングする範囲を最適化することが可能です。

## トレードオフ

### デザイナーにとっての「コンポーネント」

デザイナーにとってコンポーネントとは、atomicな**UIコンポーネント**を指すことが多く、システム的振る舞いを持たない場合も多いので、コミュニケーショにおいては注意が必要です。

Reactにおいては、ページコンポーネントのように非常に大きなコンポーネントや、システム的振る舞いのみを定義したContainerコンポーネントやProviderコンポーネントなど、デザイン文脈では登場しないコンポーネントも多数存在します。

### コンポーネント間のやりとり

コンポーネントは高い独立性を持ちますが、**Props**を通じて様々なカスタマイズ性が実現できます。

```tsx
<Button colorPalette="teal" variant="solid">
  click me
</Button>
```

しかし、深い階層のコンポーネントが必要とするPropsを中間コンポーネントで渡し続けるような実装は、_Props Drilling_（Propsのバケツリレー）と呼ばれアンチパターンとされています。

```tsx
// `<Greeting>`で使う`user`を`<Header>`から渡し続けているProps Drillingの様子
// header.tsx
<Header user={user} />

// user-card.tsx
<UserCard user={user} />

// greeting.tsx
<Greeting user={user} />
```

[Context API](https://ja.react.dev/learn/passing-data-deeply-with-context)や[jotai](https://jotai.org/)のような3rd partyライブラリを用いることで、Propsを介さずにコンポーネント間で情報を共有することが可能なので、*Props Drilling*になりそうな場合にはこれらの利用を適宜検討しましょう。

---
title: "「小さなAPI」設計"
---

## 要約

バックエンドのAPIはユースケースに強く依存しない、リソース志向な「小さなAPI」を意識しましょう。

:::message
このchapterの主題は「App Routerが利用するバックエンドAPIの設計」の話です。App Routerにおける[Route Handler](https://nextjs.org/docs/app/building-your-application/routing/route-handlers)の話題ではないのでご注意ください。
:::

## 背景

[データフェッチ on Server Components](part_1_server_components)で述べたように、Restful APIにおいて通信回数を優先するとページに必要な情報を全て取得するなどのユースケース志向な**大きなAPI**になりがちで、変更容易性やAPIのパフォーマンス問題が起きやすい傾向にあります。一方**小さなAPI**は関心ごと重視のリソース志向な設計になるので、変更容易性に優れる傾向にありますが、APIエンドポイント自体が増えて通信回数が増えがちです。

- 理想は常に「小さなAPI」だった
  - クライアントサイドデータフェッチでは通信回数が増えるとパフォーマンス劣化を起こしやすかった
  - Pages Routerではトップレベルでのデータフェッチしか方法がなかったため、結局ページを意識したAPI設計になりがちだった

## 設計・プラクティス

- Server Componentsによってデータフェッチのコロケーションが可能になった
- ユースケース単位はページからコンポーネントへの変わったが、コンポーネントに対応するAPI設計など当然ながら扱いづらいことが想像に難しくない
- リソース志向な小さなAPIにする方がApp Routerとの相性が良い
  - リソース志向な小さなAPIでは、ユースケース志向なAPIと違ってデータの重複を排除できる
  - 「小さなAPI」はバックエンドAPIとしても設計しやすい(はず)
  - GraphQLのアナロジー(Metaの事例)

## トレードオフ

バックエンドAPI開発者に従来のMVCの感覚を捨てさせ、App Routerの設計思想を理解してもらうことにハードルがあるかもしれない。しかしアーキテクチャの負債は最も厄介な負債の1つなので、妥協せず懇切丁寧な説明で理解を得ましょう。

---
title: "react-hook-formとformの設計原則"
emoji: "📝"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["react"]
published: false
---

reactでformを作る時、[react-hook-form](https://react-hook-form.com/)を使う方も多いと思います。react-hook-fomで実装すると、非制御コンポーネントベースなためレンダリングコストを減らすことが期待でき（実装にもよります）、また、[zod](https://zod.dev/)との連携によるバリデーション実装の容易さなど、実装や設計面においても多くのメリットが得られます。

一方で、チームでreact-hook-fomを使って実装を進めていくには設計的難しさを伴うことがあります。特に、筆者は以下2つのケースで設計の見直しを迫られました。

- formにおけるモーダルの実装方法
- 保存ボタンの移動容易性

本稿はこれらの課題に直面し、設計を見直すことで筆者が感じたreact-hook-fomを使った実装における設計原則のまとめになります。

:::message
本稿ではreact-hook-fomの初歩的な実装や基本的なAPIについては解説しないので、まだ触ったことがない・自信がないという方は[get-started](https://react-hook-form.com/get-started)から入門することをお勧めします。
:::

## form実装の3原則

先に結論です。react-hook-fomを使ったform実装においては以下の3つの原則を守ることが設計上重要になってきます。

1. formはRHFで統一する
2. 選択モーダルは1つのformとして扱う
3. 保存処理は常に分離を意識する

これらの原則について、1つづつ詳解していきます。

- form実装の3原則
  1. formはRHFで統一する
  2. 選択モーダルは1つのformとして扱う
  3. 保存処理は常に分離を意識する
- formはRHFで統一する
  - 当たり前だが、1つのライブラリに集約することが望ましい
  - ここではRHFを推したい
  - ただし、RHFだと作りづらいUIというのがある
    - モーダルとかサジェストUIとか
  - 作りづらいUIが出てきたときに、RHF以外で実装しようかなって考えてしまう
  - が、RHFによせておかないと実装者によってぶれたり、末端のコンポーネントが利用者を知り過ぎてたりしてしまう
  - なので、「formの実装はRHFでやる」に統一した方が良い
- 選択モーダルは1つのformとして扱う
  - TBW: モーダルの挙動パターンを整理して話を進める
  - これらもformを構成する入力要素として扱うとわかりやすい
  - とはいえ、1つの入力要素として扱うには大きすぎると感じるはず
  - モーダルを開く・選択を表示する要素を1つの入力要素として扱い、モーダルは1つのフォームとして扱おう
  - formはそもそも1つのトランザクションとみなすことができる
  - モーダルも1つのトランザクションプロセスであり、formとして扱える
    - 仕様にもよるが、多くのデザイナーがそう認識しており、モーダル<->ページはよくある変更（個人の経験含む）
    - 「保存しないと閉じれないモーダル」「閉じたら保存しちゃうモーダル」は個人的にはあまり良くない体験な場合がある
      - ↑で違和感ない場合、RHFで実装するのはそうむずかしくないので割愛
  - 実際、モーダルを1つのformとして扱うと、後でページにしたり、逆にページをモーダルにしたりするのに苦労しない
  - ということで、モーダルは1つのformであり、formとformをsetValueで繋げばモーダル<->ページのような変更でも苦労しない
- 保存処理は常に分離を意識する
  - 入力要素と保存処理は分けておかないと苦労しがち
  - 単一責務の原則に似てるかも
- まとめ
  - Formの実装はフロントエンドでも特に複雑で、かつビジネス価値の高い部分
  - EFO文脈はよく聞く、それくらいよく変わるし最適化すべき
  - 一方で、実は想像以上に実装が難しいUIである
  - RHFはすばらしい
  - 自由度が低く、難しい実装がしづらいという側面もある、だから気に入ってる
  - 設計が難しいのはある。
  - 参考になれば、幸いです

todo: サンプル実装



---
title: "エンジニアの制約を超えろ - 開発価値の最大化と制約理論"
emoji: "🏃"
type: "idea" # tech: 技術記事 / idea: アイデア
topics: ["制約理論", "TOC", "プロダクト開発"]
published: false
---

**制約理論**や**TOC**という単語を聞いたことはありますか？筆者のエンジニアキャリアの大半はプロダクト開発に従事しており、大きいプロジェクトに参画していた時期もあれば、小さい案件を数多くこなすこともありました。その中でウォーターフォールやスクラム開発・リーン開発を意識したかんばん方式など様々な開発フローを経験させていただき、リーンやアジャイルで語られるプラクティスや原則を実践・体感し、この制約理論によってより本質的な開発プロセスにおける改善の原則が理解できた気がしています。制約理論は、現在の筆者のプロダクト開発における価値観の根幹に位置する重要な思想であり、もっと多くのエンジニアに知ってほしいと思っている理論です。

## 会社にとってのTHE GOAL

制約理論は[THE GOAL](https://promo.diamond.jp/books/the-goal/)という本で提唱された理論です。制約理論とは何かを解説する前に、まず会社の目的(=THE GOAL)について考えてみます。「商品を売ること」「社会に貢献すること」など、人によって答えは様々かもしれませんが、THE GOALにおいてはキャッシュフロー、つまりお金を儲けることを目的と置いています。

当然ですが儲かれば何をしてもいいわけではないので、より厳密に定義するならば、**ユーザーに価値を提供し、対価としてお金を儲けること**こそが会社の目標であると筆者は考えています。当たり前の話だと思う方もいらっしゃるかもしれませんが、プロダクト開発においてはこの目標が「プロジェクトを終わらすこと」「リリースすること」などに置き変わってしまっていることもあるので、認識齟齬が起きないよう改めてこれを目標としています。

## 価値とは何か

「ユーザーに価値を提供し、対価としてお金を儲けること」を目標とした時に、ここで言う価値とは何なのかもう少し細分化してみましょう。価値をユーザーにとっての品質観点から分析する、[狩野モデル](https://ja.wikipedia.org/wiki/%E7%8B%A9%E9%87%8E%E3%83%A2%E3%83%87%E3%83%AB)を参考に考えてみます。

狩野モデルでは品質をいくつかに分類しますが、ここでは代表的な以下の3つに絞って考えてみます。

- **魅力品質**: 高いと満足になるが、低くても不満足にはならない。検索サイトのレコメンド機能など。
- **一次元的品質**: 高いと満足になり、低いと不満足になる。ストレージにおける容量など。
- **当たり前品質**: 高くても満足にはならないが、低いと不満足になる。サイトパフォーマンスなど。

![](/images/the-goal-of-engineer/kano.png)

ユーザーが価値を感じるには上記品質のどれかを満たすのではなく、全てにおいてバランス良く品質を提供する必要があります。

狩野モデルの分類はユーザーにとっての品質であり、いわゆる**外部品質**の分類です。一方で運営側である会社や開発チームにとっての品質、例えば保守性などの品質は**内部品質**と呼ばれます。外部品質は内部品質によって支えられています。内部品質はスピードのトレードオフとして交渉されることがありますが、それは成り立たずただ崩壊へ近づくことはt-wadaさんの[質とスピード](https://speakerdeck.com/twada/quality-and-speed-2022-spring-edition)を読むとよくわかります。

https://speakerdeck.com/twada/quality-and-speed-2022-spring-edition?slide=28

ここまでをまとめると、ユーザーにとっての価値とは外部品質として分類することができ、これらがバランス良く高い状態にあることです。そして外部品質は内部品質によって支えられている、ということになります。

## エンジニアリングのKPI

さて、お金が儲かることが最大目標とはいいつつ、そのために開発チームが営業とかまで含めて頑張ればいいのかというと、もちろんそうではありません。開発チームが会社の目標（売上の向上）のためにやれること、**プロダクトを高い品質で迅速に提供する**ことです。つまりKPIとしては**外部品質**と**スピード**の2つです。

プロダクトの外部品質を高く迅速に提供するには、どうすればいいでしょうか？ここでよくある勘違いが、内部品質をトレードオフすることです。具体的には、下記などが考えられます。

- ユニットテストの実装工数を減らそう
- リファクタした方がよさそうだけど後にしよう
- レビュー工数を減らすためにレビュアーを減らそう

これらで内部品質をトレードオフすると結果、スピードが低下します（詳しくは前述の[質とスピード](https://speakerdeck.com/twada/quality-and-speed-2022-spring-edition)参照）。内部品質はトレードオフするのではなく、高く維持することでスピードを得ることができるのです。つまり、外部品質とスピードを支える重要なマイクロKPIが、**内部品質**になります。

では他に、開発フローにおいて工夫するポイントはないのでしょうか？ここで**制約理論**の出番です。

## 制約理論

制約理論は「**どんなシステムであれ、常に、ごく少数（たぶん唯一）の要素または因子によって、そのパフォーマンスが制限されている**」（参考:[TOC協会](https://japan-toc-association.org/basic_concept/)）という仮定の元提唱された経営理論です。

例として、車業界で考えてみましょう。昨今の半導体不足の影響で新車の納車にかかる時間や納車の総量というのは、全体的に凹んでいる状態が長く続いています。これは現在、半導体の生産量が納車の総量を制限していることを表しており、**ボトルネック**なのです。仮にボトルネックである半導体の生産量が倍になれば、納車できる車の数は倍になるかもしれません。

このように、全体のアウトプットを制限しているボトルネックを見つけ、解消・最適化を行うことこそが唯一アウトプットのパフォーマンスを改善する方法であるというのが、**制約理論**と呼ばれるものです。

## ボトルネックと最適化

制約理論における目的に併せた最適化は以下のようなステップに分かれます。

1. ボトルネックを探す
2. ボトルネックを最適化する

開発フローにおけるボトルネックはケースバイケースで、必ずしも決まったところにあるわけではありませんが、筆者の経験からよくあるボトルネックとその改善例をいくつかあげてみたいと思います。

### 例1 要件定義がボトルネックの場合

開発プロジェクトの初期においては、要件定義がボトルネックになることがあります。開発メンバーのアサインや技術選定、各種環境構築などが終わったけどまだ要件が決まっていないっということはよくある話だと思います。

要件定義がボトルネックなら、**要件定義を早く終わらせる努力だけが目標に対して効果のある努力**になります。ここでエンジニアが要件定義を早く終わらせるためにやれることとしては、エンジニアが細かい要件定義を巻き取ってしまうことや、プロトタイプを実装して要件定義の判断材料とするなどです。

よくあるのが、「要件が決まらず実装すると無駄になる」という意見です。制約理論においては、**制約以外に対する最適化の努力は無駄か状況を悪化させる**と言われています。実装を無駄にしないことが最適解ではなく、要件を早く終わらせるために無駄な実装（捨てるかもしれないプロトタイプなど）を進んで行って兎にも角にも要件定義を終わらせることのみが、「プロダクトを高い品質で迅速に提供する」ための最適解になります。

要件が決まるまで暇で本来なくてもいいような優先度の低い機能の実装を進めたり、「早く要件が欲しい」とプレッシャーをかけるくらいなら、エンジニアという枠を超えて要件定義したり、早期にプロト作成して課題を見つけるなどすることが全体の品質やスピードを改善するのです。

TBW

## 構成

- 制約理論
    - 例2 レビューやテストがボトルネックの場合
      - 優先度の徹底
      - 人の手を埋めることは大事じゃない
    - 例3 バグ修正がボトルネックの場合
      - それが品質上及ぼす影響度を見極めて、リリース後の対応にしたり注釈などでフォローする
  - ボトルネックは悪なのか
    - ボトルネックはネガティヴなイメージ
    - クリティカルパスって言うと？
    - ボトルネックはただの現実なので悪じゃない、むしろ最も大事なところな可能性すらある
    - ボトルネックタスクを急かすと品質が悪化してよりボトルネック依存が強まる
    - ボトルネックにあわせて全体を最適化することこそが重要
- プロダクト開発と制約理論
  - 開発のボトルネックの多くは開発前にある
    - 当然、開発フロー自体にボトルネックがあることもある
    - が、そもそも優先度が低いものが計画に入ってたり、逆に優先度が高いはずのものがないことは多々ある
    - 仕様調整は勇気がいる、そして大変
    - だがこれをガチると効果抜群なことがある
    - どんなに優秀な人が計画してても、実装するまでわからないことは絶対ある
    - エンジニアも仕様調整するのが、結果ボトルネックの最適化に繋がることがあるのだ
  - 開発中のボトルネックになりやすい品質問題
    - 開発中ボトルネックと化しやすいのは品質である
    - 急かされるスケジュールに品質に目を瞑り、結果バグ対応で後半パンクした経験はあるかい？
    - 今やっておかないと辛いけどやる時間がないって思ったものは、大抵今やったほうがいい
    - 問題の先延ばしは目の前のスケジュールしか解決しない
- まとめ
    - 会社は売り上げが大事で、売り上げは価値創出から生まれる
    - 僕らは価値創出をするのが仕事
    - ボトルネックに合わせて全体を最適化すると価値創出が高まる(制約理論)
    - 価値創出が目的なので、品質軽視な最適化は絶対に避けよう~~

---
title: "エンジニアの制約を超えて - 開発価値の最大化と制約理論"
emoji: "🏃"
type: "idea" # tech: 技術記事 / idea: アイデア
topics: ["制約理論", "TOC", "プロダクト開発"]
published: false
---

**制約理論**や**TOC**という単語を聞いたことはありますか？筆者のエンジニアキャリアの大半はプロダクト開発に従事しており、大きいプロジェクトに参画していた時期もあれば、小さい案件を数多くこなすこともありました。その中でウォーターフォールやスクラム開発・リーン開発を意識したかんばん方式など様々な開発フローを経験させていただき、リーンやアジャイルで語られるプラクティスや原則を実践・体感し、この制約理論によってより本質的な開発プロセスにおける改善の原則が理解できた気がしています。制約理論は、現在の筆者のプロダクト開発における価値観の根幹に位置する重要な思想であり、もっと多くのエンジニアに知ってほしいと思っている理論です。

本稿はエンジニアという名前の制約を超えて、プロダクト開発価値を最大化するために制約理論を知ってもらおうという記事です。

## 会社にとってのTHE GOAL

制約理論は[THE GOAL - 企業の究極の目的とは何か](https://promo.diamond.jp/books/the-goal/)という本で提唱されたマネジメント理論です。制約理論とは何かを解説する前に、まず会社の目標(=THE GOAL)について考えてみます。「商品を売ること」「社会に貢献すること」など、人によって答えは様々かもしれませんが、THE GOALにおいてはキャッシュフロー、つまりお金を儲けることを目標と置いています。

当然ですが儲かれば何をしてもいいわけではないので、より厳密に定義するならば、**ユーザーに価値を提供し、対価としてお金を儲けること**こそが会社の目標であると筆者は考えています。当たり前の話だと思う方もいらっしゃるかもしれませんが、プロダクト開発でもこの目標が「プロジェクトを終わらすこと」「リリースすること」などに置き変わってしまっていることもあるので、認識齟齬が起きないよう改めてこれを目標としています。

## 価値とは何か

「ユーザーに価値を提供し、対価としてお金を儲けること」を目標とした時に、ここで言う価値とは何なのかもう少し細分化してみましょう。価値をユーザーにとっての品質観点から分析する、[狩野モデル](https://ja.wikipedia.org/wiki/%E7%8B%A9%E9%87%8E%E3%83%A2%E3%83%87%E3%83%AB)を参考に考えてみます。

狩野モデルでは品質をいくつかに分類しますが、ここでは代表的な以下の3つに絞って考えてみます。

- **魅力品質**: 高いと満足になるが、低くても不満足にはならない。検索サイトのレコメンド機能など。
- **一次元的品質**: 高いと満足になり、低いと不満足になる。ストレージにおける容量など。
- **当たり前品質**: 高くても満足にはならないが、低いと不満足になる。サイトパフォーマンスなど。

![](/images/the-goal-of-engineer/kano.png)

ユーザーが価値を感じるには上記品質のどれかを満たすのではなく、全てにおいてバランス良く品質を提供する必要があります。

狩野モデルの分類はユーザーにとっての品質であり、いわゆる**外部品質**の分類です。一方で運営側である会社や開発チームにとっての品質、例えば保守性などの品質は**内部品質**と呼ばれます。外部品質は内部品質によって支えられています。内部品質はスピードのトレードオフとして交渉されることがありますが、それは成り立たずただ崩壊へ近づくことはt-wadaさんの[質とスピード](https://speakerdeck.com/twada/quality-and-speed-2022-spring-edition)を読むとよくわかります。

https://speakerdeck.com/twada/quality-and-speed-2022-spring-edition?slide=28

ここまでをまとめると、ユーザーにとっての価値とは外部品質として分類することができ、これらがバランス良く高い状態にあることが望ましい状態です。そしてこの外部品質は、保守性などの内部品質によって支えられています。

## エンジニアリングのKPI

さて、お金が儲かることが最大目標とはいいつつ、そのために開発チームが営業とかまで含めて頑張ればいいのかというと、もちろんそうではありません。開発チームが会社の目標のためにやれることは**プロダクトを高い品質で迅速に提供する**ことです。つまりKPIとしては**外部品質**と**スピード**の2つです。

プロダクトの外部品質を高く迅速に提供するには、どうすればいいでしょうか？ここでよくある勘違いが、内部品質をトレードオフすることです。具体的には、下記などが考えられます。

- ユニットテストの実装工数を減らそう
- リファクタした方がよさそうだけど後にしよう
- レビュー工数を減らすためにレビュアーを減らそう

これらで内部品質をトレードオフすると結果、スピードが低下します（再掲:[質とスピード](https://speakerdeck.com/twada/quality-and-speed-2022-spring-edition)）。内部品質はトレードオフするのではなく、高く維持することでスピードを得ることができるのです。つまり、外部品質とスピードを支える重要なマイクロKPIが、**内部品質**になります。

では他に、開発フローにおいて工夫するポイントはないのでしょうか？ここで**制約理論**の出番です。

## 制約理論

制約理論は「**どんなシステムであれ、常に、ごく少数（たぶん唯一）の要素または因子によって、そのパフォーマンスが制限されている**」（参考:[TOC協会](https://japan-toc-association.org/basic_concept/)）という仮定の元提唱された理論です。

例として、車業界で考えてみましょう。昨今の半導体不足の影響で新車の納車にかかる時間や納車の総量というのは、全体的に凹んでいる状態が長く続いています。これは現在、半導体の生産量が納車の総量を制限していることを表しており、**ボトルネック**なのです。仮にボトルネックである半導体の生産量が倍になれば、納車できる車の数は倍になるかもしれません（もちろん100倍になっても100倍納車できるわけじゃないので、あくまで例です）。

このように、全体のアウトプットを制限しているボトルネックを見つけ、最適化を行うことこそが唯一アウトプットのパフォーマンスを改善する方法であるというのが、**制約理論**と呼ばれるものです。

## ボトルネックと最適化

制約理論における最適化は以下のようなステップに分かれます。

1. **ボトルネックを探す**
2. **ボトルネックを最適化する**

開発フローにおけるボトルネックはケースバイケースで、必ずしも決まったところにあるわけではありませんが、筆者の経験からよくあるボトルネックとその改善例をいくつかあげてみたいと思います。

### 例1 要件定義がボトルネックの場合

開発プロジェクトの初期においては、要件定義がボトルネックになることがあります。開発メンバーのアサインや技術選定、各種環境構築などが終わったけどまだ要件が決まっていないっということはよくある話だと思います。

要件定義がボトルネックなら、**要件定義を早く終わらせる努力だけが目標に対して効果のある努力**になります。ここでエンジニアが要件定義を早く終わらせるためにやれることとしては、以下のようなものが挙げられます。

- エンジニアが開発論点の多い要件定義を巻き取ってしまう
- プロトタイプを実装して要件定義の判断材料とする

ここでよくある議論が、「要件が決まらず実装すると無駄になる」という意見です。制約理論においては、**制約以外に対する最適化の努力は無駄か状況を悪化させる**と言われています。実装を無駄にしないことは労力の最適化にはなれど、目標である「プロダクトを高い品質で迅速に提供する」に対しては効率的な選択とは限りません。要件を早く終わらせるために無駄な実装（捨てるかもしれないプロトタイプなど）を進んで行ってでも兎にも角にも要件定義を終わらせることのみが、「プロダクトを高い品質で迅速に提供する」ための最適解になります。

「エンジニアの仕事なのだろうか」と疑問に思う方もいるかもしれませんが、時にエンジニアという枠を超えてボトルネックの最適化に取り組むことが開発価値の最大化への大きな一歩だと筆者は考えています。

この例のポイントです。

- 時にエンジニアの枠を超えてボトルネックに取り組むことも重要
- 後々無駄になる実装（不要になるかもしれないプロトタイプ実装）が、全体のスピードを早めることもある

### 例2 レビューやテストがボトルネックの場合

要件定義後の実装フェーズにおいてよくあるボトルネックがレビューやテストです。品質維持観点でレビューアーをリーダーに絞ってたり、テスターが要件定義を担ってた人1人など状況は様々考えられますが、これらはよくボトルネックになる印象です。

これらがボトルネックである場合、どういった最適化が可能なのでしょう？こういった場合によく陥ってるのが、**優先度が低いレビューやテストの混在**です。実装者が複数人いる場合、全員が優先度が高いタスクだけを持ってるとは限りません。プロジェクト後半で優先度が高いタスク自体が少なかったり、古参なメンバーが優先度の高いタスクを持って他メンバーは優先度が中〜低のものを担当してることはよくあることでしょう。

最適化として考えられるのは、この**優先度の低いタスクを一旦停止し、優先度の高いタスクに人員を割り当てる**ということです。レビューやテストは優先度が低くても溜まってしまうと心理的負担が大きいので、優先度が低くてもがんばって解消しようとしてしまうという経験はある方は多いのではないでしょうか？しかし、レビュアーやテスターがボトルネックの場合、いかにレビュアーやテスターを優先度の高いタスクに集中させるかの方が、開発メンバーの手を埋めることより重要になります。優先度の低いタスクを担当していたメンバーにレビュアーやテスターが担っていたタスクを少しでも分配することを目指しましょう。どうしても手が空いてしまいそうでも、もしそれが優先度が低いタスクをレビュアーに依頼しなければならないようなら避けましょう。

これは少々勇気のいる決断になることでしょう。直感的には手を埋めることが最も効率的に思えるからです。しかし、これも[THE GOAL](https://promo.diamond.jp/books/the-goal/)で否定されている内容の近いものです。

「いいかいゴロー、最も倒産に近い工場というのは...」

この例のポイントです。

- 人の手を埋めることがボトルネックを強めてしまうことがある
- 以下に全員で優先度が高いタスクを消化するかが重要

### 例3 バグ修正がボトルネックの場合

最後はバグが頻発してボトルネックになる場合です。バグは内部品質を高く維持することができればそもそも大きなボトルネックにはなりにくい部分です。しかし現実には、急かされるスケジュールに品質に目を瞑り、結果バグ対応で後半パンクしたような経験がある方も多いのではないでしょうか？（私はあります）

これに対する最適化はシンプルですが難しく、内部品質の問題を先延ばしにしないことの徹底です。問題の先延ばしは目の前のスケジュールを解決するかもしれませんが、全体のスケジュールで見るとバグ対応が大きな割合を占めて結果大幅に遅延を発生させたりします。目の前のスケジュールが遅れないように頑張ってるつもりが、全体で見ると今取り組むべき課題を見過ごしてしまうことは多々あることです。これは**局所最適と全体最適**の関係にも似ています。経験的には「今やっておかないと辛いけどやる時間がない」って思ったものの大半は、結果すぐやった方がいいことの方が多かったと感じています。

この例のポイントです。

- 目の前のスケジュールを守ることより、全体のスケジュールを守るために内部品質を維持することが重要

## ボトルネックは悪なのか

TBW

## 構成

- ボトルネックは悪なのか
  - ボトルネックはネガティヴなイメージ
  - クリティカルパスって言うと？
  - ここまで読んでわかったと思うがボトルネックはただの現実なので悪じゃない、むしろ最も大事なところな可能性すらある
  - ボトルネックタスクを急かすと品質が悪化してよりボトルネック依存が強まる
  - ボトルネックにあわせて全体を最適化することこそが重要
- まとめ
  - 会社は売り上げが大事で、売り上げは価値創出から生まれる
  - 僕らは価値創出をするのが仕事
  - ボトルネックに合わせて全体を最適化すると価値創出が高まる(制約理論)
  - 価値創出が目的なので、品質軽視な最適化は絶対に避けよう~~

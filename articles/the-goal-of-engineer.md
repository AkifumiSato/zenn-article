---
title: "エンジニアの制約を超えて - 開発価値の最大化と制約理論"
emoji: "🏃"
type: "idea" # tech: 技術記事 / idea: アイデア
topics: ["制約理論", "TOC", "プロダクト開発"]
published: false
---

**制約理論**や**TOC**という単語を聞いたことはありますか？筆者のエンジニアキャリアの大半はプロダクト開発に従事しており、大きいプロジェクトに参画していた時期もあれば、小さい案件を数多くこなすこともありました。その中でウォーターフォールやスクラム開発・リーンを意識したかんばん方式など様々な開発フローを経験させていただき、リーンやアジャイルで語られるプラクティスや原則を実践・体感し、この制約理論によってより本質的な開発プロセスにおける改善の原則が理解できた気がしています。制約理論は、現在の筆者のプロダクト開発における価値観の根幹に位置する重要な思想であり、もっと多くのエンジニアに知ってほしいと思っている理論です。

本稿はエンジニアという名前の制約を超えて、プロダクト開発価値を最大化するために制約理論を知ってもらおうという記事です。

## 会社にとってのTHE GOAL

制約理論は「[THE GOAL - 企業の究極の目的とは何か](https://promo.diamond.jp/books/the-goal/)」という本で提唱されたマネジメント理論です。制約理論とは何かを解説する前に、まず会社の目標(=THE GOAL)について考えてみます。「商品を売ること」「社会に貢献すること」など、人によって答えは様々かもしれませんが、THE GOALにおいてはキャッシュフロー、つまりお金を儲けることを目標と置いています。

当然ですが儲かれば何をしてもいいわけではないので、より厳密に定義するならば、**ユーザーに価値を提供し、対価としてお金を儲けること**こそが会社の目標であると筆者は考えています。当たり前の話だと思う方もいらっしゃるかもしれませんが、プロダクト開発でもこの目標が「プロジェクトを終わらすこと」「リリースすること」などに置き変わってしまっていることもあるので、認識齟齬が起きないよう改めてこれを目標としています。

## 価値とは何か

「ユーザーに価値を提供し、対価としてお金を儲けること」を目標とした時に、ここで言う価値とは何なのかもう少し細分化してみましょう。価値をユーザーにとっての品質観点から分析する、[狩野モデル](https://ja.wikipedia.org/wiki/%E7%8B%A9%E9%87%8E%E3%83%A2%E3%83%87%E3%83%AB)を参考に考えてみます。

狩野モデルでは品質をいくつかに分類しますが、ここでは代表的な以下の3つに絞って考えてみます。

- **魅力品質**: 高いと満足になるが、低くても不満足にはならない。検索サイトのレコメンド機能など。
- **一次元的品質**: 高いと満足になり、低いと不満足になる。ストレージにおける容量など。
- **当たり前品質**: 高くても満足にはならないが、低いと不満足になる。サイトパフォーマンスなど。

![](/images/the-goal-of-engineer/kano.png)

ユーザーが価値を感じるには上記品質のどれかを満たすのではなく、全てにおいてバランス良く品質を提供する必要があります。

狩野モデルの分類はユーザーにとっての品質であり、いわゆる**外部品質**の分類です。一方で運営側である会社や開発チームにとっての品質、例えば保守性などの品質は**内部品質**と呼ばれます。外部品質は内部品質によって支えられています。内部品質はスピードのトレードオフとして交渉されることがありますが、それは成り立たずただ崩壊へ近づくことはt-wadaさんの[質とスピード](https://speakerdeck.com/twada/quality-and-speed-2022-spring-edition)を読むとよくわかります。

https://speakerdeck.com/twada/quality-and-speed-2022-spring-edition?slide=28

### まとめ

ここまでが最初の大事なポイントなので、一旦まとめてみましょう。

ユーザーにとっての価値とは外部品質として分類することができ、これらがバランス良く高い状態にあることが望ましい状態です。そしてこの外部品質は、保守性などの内部品質によって支えられています。

## エンジニアリングのKPI

さて、お金が儲かることが最大目標とはいいつつ、そのために開発チームが営業も頑張れるようになればいいのかというと、もちろんそうではありません。開発チームが会社の目標のためにやれることは**プロダクトを高い品質で迅速に提供する**ことです。つまりKPIとしては**外部品質**と**スピード**の2つです。

プロダクトの外部品質を高く迅速に提供するには、どうすればいいでしょうか？ここでよくある勘違いが、内部品質をトレードオフすることです。具体的には、下記などが考えられます。

- ユニットテストの実装工数を減らそう
- リファクタした方がよさそうだけど後にしよう
- レビュー工数を減らすためにレビュアーを減らそう

これらで内部品質をトレードオフすると結果、スピードが低下します（再掲:[質とスピード](https://speakerdeck.com/twada/quality-and-speed-2022-spring-edition)）。内部品質はトレードオフするのではなく、高く維持することでスピードを得ることができるのです。また、内部品質が低いとバグ発生率が上がり、当たり前品質が低下する可能性が高いです。つまり、外部品質とスピードを支える重要なマイクロKPIが、**内部品質**になります。

外部品質とスピードを向上させるには、内部品質の向上以外にマイクロKPIはないのでしょうか？実はスピードは、**ボトルネック**に大きく左右されます。このボトルネックに注目し最適化を目指すのが**制約理論**です。

![](/images/the-goal-of-engineer/kpi.png)

[//]: # (https://docs.google.com/presentation/d/1anrO4fHKVerzglGaH276Buh-rl99xkCy4yt6jUgh2No/edit#slide=id.g1bbe06e13b6_0_0)

## 制約理論

制約理論は「**どんなシステムであれ、常に、ごく少数（たぶん唯一）の要素または因子によって、そのパフォーマンスが制限されている**」（参考:[TOC協会](https://japan-toc-association.org/basic_concept/)）という仮定の元提唱された理論です。

例として、車業界で考えてみましょう。昨今の半導体不足の影響で新車の納車にかかる時間や納車の総量というのは、全体的に凹んでいる状態が長く続いています。これは現在、半導体の生産量が納車の総量を制限していることを表しており、**ボトルネック**なのです。仮にボトルネックである半導体の生産量が倍になれば、納車できる車の数は倍になるかもしれません。

:::message
ただし、半導体の生産量が100倍になっても100倍納車できるわけではありません。ボトルネックは常に状況によってうつろいゆくものなのです。
:::

このように、全体のアウトプットを制限しているボトルネックを見つけ、最適化を行うことこそが唯一アウトプットのパフォーマンスを改善する方法であるというのが、**制約理論**です。

## ボトルネックと最適化

制約理論における最適化は以下のようなステップに分かれます。

1. **ボトルネックを探す**
2. **ボトルネックを最適化する**

開発フローにおけるボトルネックはケースバイケースで、必ずしも決まったところにあるわけではありませんが、筆者の経験からよくあるボトルネックとその改善例をいくつかあげてみたいと思います。

### 例1 要件定義がボトルネックの場合

開発プロジェクトの初期においては、要件定義がボトルネックになることがあります。開発メンバーのアサインや技術選定・各種環境構築などが終わったが、開発着手できるほどまだ要件が決まっておらずエンジニアが暇を持て余してしまうことはよくある話だと思います。

要件定義がボトルネックなら、**要件定義を早く終わらせる努力だけが目標に対して効果のある努力**になります。ここでエンジニアが要件定義を早く終わらせるためにやれることとしては、**開発論点の多い要件定義を巻き取る**ことなどが挙げられます。

「それはエンジニアの仕事なのだろうか」と疑問に思う方もいるかもしれませんが、制約理論においては、**制約以外に対する最適化の努力は無駄か状況を悪化させる**と言われています。例えばエンジニアの手を埋めるために無理なスケジュールで要件定義を進めて、品質の低い要件定義しかできず結果手戻るなどといった、ボトルネック以外への最適化努力がボトルネックに悪影響を及ぼす可能性を示唆しています。

時にエンジニアという枠を超えてボトルネックの最適化に取り組むことは、開発価値の最大化へ
の大きな一歩だと筆者は考えています。

この例のポイントです。

- 時にエンジニアの枠を超えてボトルネックに取り組むことも重要

### 例2 レビューやテストがボトルネックの場合

要件定義後の実装フェーズにおいてよくあるボトルネックがレビューです。複数人の開発チームでリーダーや古参メンバーが必須レビュアーを担っていることはよくあるケースです。レビューがボトルネックである場合、どういった最適化が可能なのでしょう？

ここで注目したいのが、レビューの優先順位です。開発メンバー全員が優先度が高いタスクだけを持ってるとは限りません。時期によって優先度が高いタスク自体が少なかったり、古参なメンバーが優先度の高いタスクを持って他メンバーは優先度が中〜低のものを担当してることはよくあることでしょう。最適化として考えられるのは、この優先度の低いタスクを一旦停止し、優先度の高いタスクに人員を割り当てるということです。スクラムなどでは**WIP制限**などと呼ばれます。メンバー1人1人に実装案件を渡し、並列に実装を進めることは効率的に見えて、実はボトルネックに負荷を強めているだけな可能性があるのです。

これは少々勇気のいる決断になることでしょう。直感的には手を埋めることが最も効率的に思えるからです。しかし、これも[THE GOAL](https://promo.diamond.jp/books/the-goal/)で否定されている内容の近いものです。

> *「ゴロー、面白いことを教えてあげよう。従業員が手を休めることなく常に作業している工場は非常に非効率なんだ。」*

これは示唆に富んでおり、**人の手を埋めること（≒リソース効率）が目標に対し必ずしも効率的とは限らない**ということです。リソース効率とフロー効率を知ってると、よりしっくり来るかもしれません。

https://speakerdeck.com/osawatanabe/productivity-and-flow-efficiency-and-resouce-efficiency?slide=16

この例のポイントです。

- 人の手を埋めること（≒リソース効率の追求）がボトルネックを強めてしまうことがある
- いかに全員で優先度が高いタスクを消化するかが重要

### 例3 バグ修正がボトルネックの場合

最後はバグが頻発してボトルネックになる場合です。バグは内部品質を高く維持することができればそもそも大きなボトルネックにはなりにくい部分です。しかし現実には、急かされるスケジュールに品質に目を瞑り、結果バグ対応で後半パンクしたような経験がある方も多いのではないでしょうか？私はあります。

これに対する最適化はシンプルですが難しく、**内部品質の問題を先延ばしにしない**ことの徹底です。問題の先延ばしは目の前のスケジュールを解決するかもしれませんが、全体のスケジュールで見るとバグ対応が大きな割合を占めて結果大幅に遅延を発生させたりします。これは**局所最適と全体最適**の関係にも似ています。体感的には「今やっておかないと辛いけどやる時間がない」って思ったものは大抵、やはりすぐやった方がいいことの方が多かったと感じています。

この例のポイントです。

- 目の前のスケジュールを守ることより、全体のスケジュールを守るために内部品質を維持することが重要

## ボトルネックは悪なのか

ここまで例でボトルネックの探し方と最適化を考えてきましたが、実際に開発現場でボトルネックを探す時には「ボトルネック」という単語のイメージに注意する必要があります。ボトルネックという単語はネガティブなイメージを持たれやすい単語ですが、制約理論においてボトルネックとは、駆逐すべき対象ではなくただの現実です。**ボトルネックは悪ではありません**。ボトルネックに対する最適化案のアンチパターンとして、無理にボトルネックを解消しようとすることが挙げられます。

例えば例2のレビューの例で言えば、「レビューがボトルネックだからスキップしてしまおう」「レビュアーを減らそう」「レビュアーとしてアサインできる人を増やそう」といったものです。これらは元々レビューで担っていた内部品質を悪化させる可能性があり、結果目標から遠ざかる可能性があります。

ボトルネックは解消するのではなく、**ボトルネックに合わせて全体を最適化する**ことこそが重要です。

## まとめ

最後にまとめです。

- 会社の目標は「ユーザーに価値を提供し、対価としてお金を儲けること」
- 開発チームの追うべきKPIは「外部品質」と「スピード」
- 「外部品質」と「スピード」は「内部品質」によって支えられている
- 開発フローをボトルネックに合わせて最適化することで、スピードが改善する

## メモ

- 外部品質はスピードに依存してる方がわかりやすいかも
  - 外部品質は開発チームのアウトプット量≒スピードに左右される
  - スピードは何に左右されるのか -> ボトルネックと内部品質

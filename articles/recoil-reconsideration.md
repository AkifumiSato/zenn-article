---
title: "Recoilはグローバル状態管理ライブラリなのか？"
emoji: "🍣"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["react", "recoil"]
published: false
---

Recoilを「Reduxと同じグローバル状態管理ライブラリ」とまとめてしまうことに若干違和感があったので、自分なりに考えをまとめてみました。

## Redux

[Redux](https://redux.js.org/)の歴史は状態管理ライブラリの中では古く、2015年に初版が公開されました。ReduxはReactに依存してないので、他のViewライブラリやRedux単体でも採用可能でしたが、React・Reduxのセットは、フロントエンドに一貫した設計を設けることができるため高い人気を得ました。

Redux登場当時は、**UIから状態管理を分けること**が多くのエンジニアの関心ごとだったと考えられます。jQueryなどをベースに実装している場合設計を統一しづらかったので、React・Reduxを導入することで一環した設計を導入できるというのが大きな魅力だったようにも感じます。

## Recoil

一方[Recoil](https://recoiljs.org/)は2020年に登場したReact専用のグローバル状態管理ライブラリです。Metaが作成し、現在でもexperimentalながら高い人気を得ています。Reduxと大きく異なる点として、code splittingが効くのでページ単位でのバンドルサイズを減らすことも大きく注目されました。

Recoilが登場した頃や昨今のエンジニアの関心ごとは、Reduxが登場した頃と違い**hooksで扱いやすいかどうか**であるように筆者は感じています。状態管理を分けることから、その手間や使い勝手に関心が移動したということです。Reduxもhooksで扱うことは当然できますが、hooksの外でやること(actionやreducerの定義、middlewareの導入など)が少々多い点で、Recoilの方が簡略化されてるように筆者は感じます。

また、Redux登場当時と違う点として、[react-hook-form](https://react-hook-form.com/)や[swr](https://swr.vercel.app/ja)など、**用途に応じた状態管理ライブラリの台頭**が挙げられます。これにより、開発者が明示的に管理するグローバルなState自体が減ってきたことで、グローバルStateとして扱うものがよりシンプルになったように感じます。State管理の複雑さが減ったことにより、より扱いやすさが求められているのかもしれません。

## グローバル状態管理とは

ここまで、ReduxもRecoilも冒頭にあったような「グローバル状態管理」という言葉にまとめてしまいましたが、ReduxとRecoilは本当に同じ「グローバル状態管理」ライブラリなのでしょうか？「グローバル」の意味の解像度をもう少し上げてみましょう。

「グローバル状態管理」には、以下2つの意味合いが混在していると筆者は考えています。

- **参照スコープ**: 文字通り参照スコープ。
- **ライフタイムスコープ**: Stateの生存期間スコープ。

これらについては以前書いた記事でも述べています。上記定義は下記の記事で行なった定義をより簡略化したものです。

https://zenn.dev/akfm/articles/react-state-scope#%E3%83%A9%E3%82%A4%E3%83%95%E3%82%BF%E3%82%A4%E3%83%A0%E3%81%AB%E3%82%88%E3%82%8Bstate%E3%81%AE%E5%88%86%E9%A1%9E

多くの文脈において「グローバル」とは参照スコープにおけるグローバルを指していることが多いように感じますが、ページ移動などでコンポーネントがアンマウントされても保持したいStateを扱う場合にも、ReduxやRecoilで状態管理することがあります。

Reduxは参照スコープとライフタイムスコープの2つの意味においてグローバルですが、Recoilの状態は必ずしも`export`せずとも利用することができるため、照スコープに対しては必ずしもグローバルとは限りません。

```tsx
const todoListState = atom({
  key: 'TodoList',
  default: [],
});

function TodoList() {
  const todoList = useRecoilValue(todoListState);

  return (
    <>
      <h1>Todo List</h1>
      {todoList.map((todoItem) => (
        <TodoItem key={todoItem.id} item={todoItem} />
      ))}
    </>
  );
}
```

上記例のは`todoListState`は、複数のコンポーネントでの利用が想定されていません。しかし`useState`とは異なり、**コンポーネントのアンマウント後も`todoListState`の値を保持することができます**。

これがライフタイムスコープ的にはグローバルなStateであることを示しますが、参照スコープにおいては`export`してないので**他ファイルで利用されることがありません**。RecoilがReduxと大きく異なるのは、参照スコープをこうして制限することができる点です。もちろん命名やState構造の設計次第で利用者を限定するようなことはよくあると思いますが、それを意識して運用することと仕組みでもって運用するのでは大きく意味が違います。

| ライブラリ | 参照スコープ | ライフタイム |
| ---- | ---- | ---- |
| Redux | グローバル | グローバル |
| Recoil | **必ずしもグローバルではない** | グローバル |

## まとめ

Reduxは参照スコープ・ライフタイムスコープ共にグローバルですが、Recoilはライフタイムスコープのみがグローバルで参照スコープは必ずしもグローバルではありません。実装要件でライフタイムスコープをグローバルに扱いたいケースが多い場合には、参照スコープがグローバルで名前空間の衝突を考える必要のあるReduxよりRecoilの方が適している可能性があります。

また、これらを除いてもRecoilにはcode splittingやhooks外の実装が簡易的などのメリットがあります。もし「グローバル状態管理ライブラリ」の選定、特にReduxとRecoilで悩むことがあったら、本当に参照スコープがグローバルであるかぜひ考えてみてください。

この記事が「グローバル状態管理ライブラリ」の選定に役立てば幸いです。

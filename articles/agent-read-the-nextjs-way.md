---
title: "AI Agentを『Next.jsの考え方』に最適化する"
emoji: "📖"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["nextjs", "react"]
published: false
---

開発者自身に明確な実装の完成イメージがある場合、それをAI Agentに出力させることは難しく、さまざまな工夫を必要とします。Agentに与えるコンテキストやプロンプトを最適化したり、詳細なルールを整備することで精度を高めることができますが、これらには大変な労力を伴います。

[『Next.jsの考え方』](https://zenn.dev/akfm/books/nextjs-basic-principle)は、筆者なりにNext.jsの設計やベストプラクティスをまとめたものです。筆者がNext.jsアプリケーションを扱う場合、実装の完成イメージはこの本の内容に沿って生成されるため、「この本をAI Agentに読ませることで推論精度を高めることができるのではないか」と考えました。

本稿は、AI Agentに『Next.jsの考え方』を適用する筆者なりの工夫や、試行錯誤した内容について紹介します。

## 要約

『Next.jsの考え方』に沿って実装を進める場合、以下の条件下においてAI Agentの精度が向上します。

- `claude-4-sonnet`^[執筆時時点でいくつかのモデルを比較した結果です。後継モデルが登場したらそちらの方がいいかもしれません。]など、最新のコーディング特化なAIモデル
- 適切な静的解析と単体テスト
- 『Next.jsの考え方』に沿って実装された、参考となる既存コード
- 都度AI Agentが『Next.jsの考え方』を参照するルール設定

## 前提

### AI Agent

筆者が検証に用いたツールとモデルは以下の通りです。

- AI Agent: Claude Code, Cursor
- AI Model: `claude-4-sonnet`

### 『Next.jsの考え方』

『Next.jsの考え方』は文字通り、Next.jsの根底にある考え方に沿った設計やプラクティスについて、筆者なりに解説したものです。

https://zenn.dev/akfm/books/nextjs-basic-principle

## 解説

以下は検証に用いたリポジトリです。

https://github.com/AkifumiSato/akfm-nextjs-rules-demo/

以下の工夫をすることでAI Agentが『Next.jsの考え方』を理解し、実装品質の精度を高めることができます。

- [静的解析と単体テスト](#静的解析と単体テスト)
- [『Next.jsの考え方』に沿った参考実装](#『Next.jsの考え方』に沿った参考実装)
- [『Next.jsの考え方』のマークダウンコピー](#『Next.jsの考え方』のマークダウンコピー)
- [都度読み込むルール作成](#都度読み込むルール作成)

### 静的解析と単体テスト

『Next.jsの考え方』を活かすかどうかに関わらず、AI Agent系のツールを使用する場合、静的解析と単体テストは非常に重要です。AI Agentの実装が想定通りに振る舞っているかどうか、また既存の振る舞いに影響していないか、既存のコードとルールの整合制が取れているか、と言った観点をAI Agent自身が確認できることは、AI Agentの実装精度を高める上で非常に重要です。

特に、`claude-4-sonnet`は静的解析や単体テストのフィードバックをもとに改善のサイクルを回すことに長けています。

筆者が行った検証では、以下のツールを使用しました。

- Biome
- TypeScript
- Vitest

### 『Next.jsの考え方』に沿った参考実装

昨今のAI Agentは、リポジトリ内の既存実装を強く学習する傾向にあります。`CLAUDE.md`や`.cursor/rules/*`などのルールドキュメント内に参考実装を記載することも効果的ですが、筆者の体感ではリポジトリ内のコードの方が強く学習されるように感じます。

そもそも、ルールと既存実装で乖離してればAIにとっては混乱の元であるであろうことは想像できるので、ルールと整合性が取れた実装をリポジトリ内に用意しておくことは非常に重要です。

### 『Next.jsの考え方』のマークダウンコピー

AI Agentに『Next.jsの考え方』を読ませるためには、マークダウンファイルが最適だと考えられます。幸い、『Next.jsの考え方』はZennで無料公開しており、原著はパブリックリポジトリで管理されています。

https://github.com/AkifumiSato/zenn-article/tree/main/books/nextjs-basic-principle

https://github.com/AkifumiSato/zenn-article/blob/main/books/nextjs-basic-principle/part_1.md

`git clone`するなりGitHubからダウンロードするなり方法は様々ですが、これらのマークダウンファイルをコピーしてNext.jsのアプリケーションのリポジトリ内に配置します。これにより、AI Agentは任意のタイミングで『Next.jsの考え方』を参照できるようになります。

### 都度読み込むルール作成

ルールはClaude Codeで`/init`で生成したものをベースに、『Next.jsの考え方』の格納場所や読むべきタイミングなどを設定します。以下は、筆者が実際に使用したルールの一例です。各々のプロジェクトに合わせて調整してください。

https://github.com/AkifumiSato/akfm-nextjs-rules-demo/blob/main/CLAUDE.md

:::message
『Next.jsの考え方』以外にも単体テストの記事など読み込むよう設定しています。
:::

## 評価

:::message
実装が『Next.jsの考え方』に沿っているかどうかを定量的に評価することは難しいため、以下は筆者の主観的な定性評価になります。
:::

筆者が検証した結果、上記の条件下でAI Agentの実装品質が向上することが確認できました。特に『Next.jsの考え方』を読ませるかどうかで、AI Agentの実装理解度に差を感じました。

『Next.jsの考え方』を読ませなかった場合、AI Agentがする実装は表面的な理解に基づくレベルに留まるため、一定以上フィードバックや自身での修正作業が伴います。一方、『Next.jsの考え方』を読み込ませるとしっかり**読者レベルの理解度**に基づいた実装が行えるようになったと感じました。これにより、より多くの作業をAI Agentに委任できるようになると筆者は感じています。

特に、筆者が難しいのではないかと感じていた[DataLoader](https://www.npmjs.com/package/dataloader)を使った実装の設計だったり、VitestやStorybookの観点の出し方がとても高い精度で行えることを確認できたので、筆者としては自分自身の思想が強く反映されたAI Agentのように感じました。

## 注意点

検証の過程で、AI Agentの精度に影響する要素がいくつかあることがわかりました。

### 『Next.jsの考え方』のサマリーをルール設定すると精度が低下する

`CLAUDE.md`に『Next.jsの考え方』のサマリーを記載することで、コンテキストやトークンの消費量を抑えつつ同様の精度を実現できるのでは？と考え検証しましたが、結果としては精度が低下したように感じました。

これは人が理解するのと同等の情報量を必要としている可能性や、AI Agentに対して同じ指示でも情報量が多い方が精度が高い可能性など様々な要因が考えられますが、詳細は不明です。

### 『Next.jsの考え方』に沿わない実装のノイズ

AI Agentは既存の実装コードを学習するため、『Next.jsの考え方』にある内容とは大きく異なる設計思想が含まれていると実装品質の低下する可能性があります。

既存の実装コードで参考にして欲しくない実装などがあれば、明示的に参考にすべき実装ファイルをコンテキストに含めるなど、工夫が必要になると思われます。

## まとめ

「自分自身の価値観を言語化してコンテキストに設定できれば、AIの推論精度は高められるのではないか」というアイディアは、以前から筆者の中にありました。ただ、価値観を言語化すること自体大変な労力が伴うため、検証できる物量に限界を感じていました。『Next.jsの考え方』が筆者の実装価値観そのものを表現したものだと気づき、実際に設定してみると体感的にAI Agentの精度が向上したため、非常に興味深く感じ、様々検証するに至りました。

本校の主題はNext.jsアプリケーションの開発でAI Agentを活用するための方法論ですが、他にも様々な示唆に富んでいると感じています。人に読んでもらうために書いた文章がAIにとっても強く有効に働き、情報の圧縮はマイナスに働きうることであったり、日頃アウトプットして自身の価値観やプラクティスを言語化しておくことがAI時代においても重要であることなど、筆者自身様々な発見を得ることができました。

今後のAIの進化を想像することは一種の面白味も感じますが、一方でエンジニアとして今目の前でやるべきことはおそらく今までとそう変わらず、日々インプットとアウトプットを続けることなのだと、筆者自身強く再認識しました。

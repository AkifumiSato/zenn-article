---
title: "チーム開発を加速するテスト戦略"
emoji: "⛳"
type: "idea" # tech: 技術記事 / idea: アイデア
topics: ["test", "jest"]
published: false
---

テストを書いてないというチームには色々理由があると思いますが、「何をテストすべきかわからない」「書き方がわからない」「どのくらいメリットがあるかわからない」という意見は多いのではないでしょうか？テスティングフレームワークの選定や使い方を学ぶのは重要ですが、それ以上に**テストの目的や戦略を学ぶことが重要**です。識者たちの説くテストの目的を学び、アプリケーションに合った戦略を立てられなければ、テストは形骸化するかプロジェクトの足を引っ張るだけになります。特にチーム開発においてテストを活かすのは相応の知識とスキルが必要になりますが、活かせればテストは開発スピードを維持・促進する飛び道具になり得ます。

本稿は筆者が取り組んで実際に高いチーム満足度と速度を得られた、テスト戦略についてまとめたものです。

:::message
- 筆者は[単体テストの考え方/使い方](https://book.mynavi.jp/ec/products/detail/id=134252)という書籍で学んだことに大きく影響されています。興味のある方はぜひこの書籍や、筆者の過去の記事[フロントエンドにおける「単体テストの考え方/使い方」](https://zenn.dev/akfm/articles/frontend-unit-testing)」を参照ください。
- 主にチーム開発におけるテストの考え方や戦略の話になりますが、筆者の特性上、Webアプリやフロントエンドを前提とした部分もあります。
:::

## テストの目的

新規開発か運用か、開発規模の大小など様々あれど、ビジネスにおいて開発速度というのは常に求められるものです。多くのWebアプリケーションは作って終わりではなく、その後も機能追加や修正などさまざまな運用をし続けることになります。初期開発においても、仕様変更・追加要件・バグ修正はほぼ確実に発生します。このような多くの変更に耐えうる**変更容易性**が中長期のみならず短期的にも必要になってきます。変更容易性を損なうと、開発プロジェクトはたちまち遅延しはじめることでしょう。

テストはプロダクションコードの変更によって起こる**リグレッション**（退行、予期せぬ変更）を検知することが可能です。プロダクションコードの変更が与えた影響が実装者以外にも明確になるので、調査や考慮漏れに伴う工数が削減されます。また、予期せぬ変更も明確になるのでバグ対応工数も削減できます。これらの削減される工数を、消して軽んじてはいけません。これらが原因で遅れた開発プロジェクトは非常に多く存在します。

**開発速度を維持すること**、そして開発速度を悪化させうる**リグレッションを防ぐこと**こそが、テストを書く大きなモチベーションです。

### テストを書くことは目的ではない

よくあるアンチパターンですが、テストを書くことが目的になってしまうことがあります。「テストを書くといいらしい、だからテストを書こう」と言ったものです。テストを書くことは目的ではありません。テストを書くことは、目的を達成するための手段の一つです。カバレッジを無理に100%にしてリグレッション検知の役には立たないようなテストを書いてしまってたり、書き方に悩んで時間を使いすぎて開発速度を損なうようなら、目的に反しています。

リグレッション検知に役立たないテストは書くべきではないですし、書き方やテスティングフレームワークの使い方に悩むのならば有識者やチームメンバーに相談すべきです。

### テストが効果的なプロジェクト

テストの目的を意識すると、テストが効果的な場合とそうでない場合があることに気づけます。フロントエンドで言うと、振る舞いのほぼないランディングページを量産するプロジェクトにおいては単体テストを書いてもあまり役に立たないかもしれませんが、VRT（Visual Regression Testing）は大いに役立つことでしょう。一方でいわゆるWebアプリケーションとよばれるものの多くでは、単体テストもVRTは非常に有用になり得ますが、E2Eテストに注力しすぎると膨大な工数を消費することになるでしょう。

## テストを運用する難しさ

正しくテストを運用するには、相応の知識とスキルが必要になってきます。具体的にはテスティングフレームワークやテスト設計自体のスキルと、それらを知識やスキルをチーム内でお互いに共有し統一されたテストをチームで運用するスキルです。

### テスティングフレームワークやテスト設計の難しさ

TBW

### 知識やスキルの共有の難しさ

チーム開発で知識やスキルを共有するのは、それ自体なかなか難しいものです。ドキュメントを用意した後に以下のようなフィードバックを受けることはないでしょうか？

- ドキュメントを読んでない
- 読んだが理解できない
- 理解できたが使えない
- 使えるけど応用はできない

これらを越えてようやく、知識とスキルの共有がなされた状態と言えることでしょう。知識とスキルの共有は、本当に難しいことです。ではどうすればチーム開発でテストを正しく運用できるのでしょう？

ここからが、戦略の話になります。

## テスト戦略

todo: どのテストに注力するか

### 単体テスト戦略

筆者は[単体テストの考え方/使い方](https://book.mynavi.jp/ec/products/detail/id=134252)を読んで、これをフロントエンドに適用するにあたり疑問点を識者に相談し、理解を深めました。得られた知識をチームに展開し、目的に沿ったテストを運用していきたいと思うと、先述の知識とスキルの共有の難しさが障壁になります。そこで、以下のstepでチームに展開していくことにしました。

- step0: 「[単体テストの考え方/使い方](https://book.mynavi.jp/ec/products/detail/id=134252)」を読む、識者に相談する
- **step1: ドキュメントの作成と共有**
- **step2: 参考になる例を実装する**
- **step3: 共有・相談・議論の場を整える**

これらについて実際にやったことを紹介します。

### step1: ドキュメントの作成と共有

まずは達成したいこと、悩みやすいポイント、サンプルをドキュメントに残します。ドキュメントはシンプルで読むのが辛くない量を目指さないと、読むハードルが上がってしまうので気をつけます。以下の記事はチーム向けの意味も込めて書いたのですが、長いのでこれをさらに要約します。

https://zenn.dev/akfm/articles/frontend-unit-testing

上記記事の内容に基づき、以下のような構成のマークダウンファイルを用意しました。見やすさ・わかりやすさのため部分的に修正・省略してます。

```markdown
## 単体テストの目的

Jest による単体テストを用いて、以下を達成することを目指す。

- リグレッション耐性: 修正による意図せぬデグレを防ぐ
- リファクタリング耐性: Flaky や壊れやすいテストを避ける
- 迅速なフィードバック: 高速なテスト実行
- テスト自体の保守性: テストコードの読みやすさ

## テスト観点

### コンポーネントのテスト観点
...

### 外部依存の取り扱い
...

### submit時の送信データの検証
...

## テストケースの記述

### コンポーネントのテスト
...

### テストフェーズの記載(AAAパターン)
...

### テストの共通化
...
```

長すぎないマークダウン1枚なら思い返したい時に読めるので、この量が適切と判断しました。ただ最初に読むきっかけがなければやはりドキュメントは読まれません。ということで、上記をほぼ読み上げるだけ＋QAの会議を設定し、口頭でもチームに上記ドキュメントを共有しました。ここで意見があれば議論し、取り込むことも重要です。

### step2: 参考になる例を実装する

TBW

### step3: 共有・相談・議論の場を整える

## 構成

- 結果
  - 実際この1年2チームで↑をやってみた
  - 個人的にはかなり効果を感じた
  - 筆者だけが感じてもしょうがないので、匿名アンケートで忌憚なき意見を募集してみた
    - テストのことに限らず、技術選定や進め方など多くの項目について聞いてみた
    - 全体的に耳が痛い話もあったし、それなりに本音で回答してもらえたと思う
  - その中でもテストについては、全体的にかなり好評だった
    - チーム満足度が高かった
    - 「テストに助けられた」「苦手意識がなくなった」「目的がはっきりして迷わなくなった」「見通しがよくなった」「手戻りが減った」「テストの分量がちょうどよかった」etc...
    - ネガティブな意見はなかった（！）
  - 筆者・チーム共に、単体テストの目的は達成できていることを実感している
  - また予期せぬ効果として、エラー時のUI実装漏れがかなり減った
    - テスト観点を考える時に、エラー時テストをよく書くために実装漏れがかなり減った
    - 手戻り観点で開発スピードには大きく貢献したように感じる
- まとめ
  - 目的の達成により、以下のような効果が得られたと考えられる
    - チームの開発体験の満足度向上
      - 開発体験の満足度が高い≒効率的・生産的な開発が実現できている
    - チームの開発スピード向上
      - 遅延リスク回避
      - 初期から一定の速度で開発し続けられていることから、プロジェクト全体で見ても早まったのでは？
        - 定量的なエビデンスは当然ないので、定性評価
          - （そもそも定量的に測るには全く同じスキルセットを持ったメンバー複数チームで同時に同じプロジェクトをやらないとわからない）
          - そこらへんの統計的データが気になる方はLeanとDevopsの科学を参照されたし
  - 一方、細かい点ではまだブラッシュアップの余地があるとも感じてる
    - プロジェクト規模にもよるし、チームメンバーのスキルにもよるので、まだまだ一概には言えない部分が多い
  - 今後も同様の活動を続けて、より良いテストの文化を多くのチームに根付かせていきたい

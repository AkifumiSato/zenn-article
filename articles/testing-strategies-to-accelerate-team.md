---
title: "チーム開発を加速するテスト戦略"
emoji: "⛳"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["test", "jest"]
published: false
---

- 序文
  - みなさんテスト、書いてますか？
  - 「時間がなくて書いてない」？
  - 「書き方がわからない」？
  - 「何をテストすべきかわからない」？
  - テストを書いてない人には、理由が色々あると思います
  - テスティングフレームワークの使い方を学ぶのは重要ですが、それ以上に目的や戦略を学ぶことが重要です
  - 前任者たちの説く単体テストの目的を学び、プロダクトに合ったテスト戦略を自分で考えることはとても重要です
  - 単調で振る舞いのほとんどないサイトなら、テストはいらないかもしれません
  - Webアプリケーションと呼ばれるものの開発に携わっているなら、多くの場合テストは開発スピードを促進・維持する飛び道具になり得ます
  - 本稿は筆者が取り組んで実際に高いチーム満足度と速度を得られた、単体テスト戦略についてまとめたものです
- テストの目的
  - 開発を遅延させる要素は何か
    - リグレッションバグ
    - 要件考慮漏れ
    - 認知負荷による修正への迷い、自信のなさ
  - これらは単体テストでカバーできるもの
  - カバー「できる」のであって必ずカバー「される」ものではない
  - 単体テストをうまく使うことで、「開発を遅延させない」ことを達成できる
    - もちろん、規模やものにもよる
    - LPにテストごりごり書いてもあまり役に立たないかもしれない
    - 極めてシンプルなTodoアプリなら、テストを書かなくてもいいかもしれない
  - 一定の規模以上なら個人・チーム問わず言うようになることが多い
    - そう言った意見が世に溢れており、また、筆者自身も経験からそう確信している
  - 単体テストを「うまく使う」には相応の知識とスキルが必要となる
  - しかし、チームで知識とスキルを共有するのはなかなか難しい
  - ドキュメントに書いても、読まれない。読んでも理解できない。理解できても使えない。使えるけど応用できない。
  - 知識とスキルの共有は、本当に難しい
  - ではどうするのか
  - ここからが戦略の話
- テストを文化にする戦略
  - 目的に沿ったテストを書くには以下がポイントになってくる
    - 達成したいことの共有
    - 考えるべきポイントを絞る
      - 外部依存の扱い方
      - 書き方や粒度
      - 共通化
    - 相談・議論の場を整える
  - 筆者はこの順番で目的に沿ったテストを実現しようと考えた
- step1: 達成したいことの共有
- step2: 考えるべきポイントを絞る
- step3: 相談・議論の場を整える
- 結果
  - 実際この1年2チームで↑をやってみた
  - 個人的にはかなり効果を感じた
  - 筆者だけが感じてもしょうがないので、匿名アンケートで忌憚なき意見を募集してみた
    - テストのことに限らず、技術選定や進め方など多くの項目について聞いてみた
    - 全体的に耳が痛い話もあったし、それなりに本音で回答してもらえたと思う
  - その中でもテストについては、全体的にかなり好評だった
    - チーム満足度が高かった
    - 「テストに助けられた」「苦手意識がなくなった」「目的がはっきりして迷わなくなった」「見通しがよくなった」「手戻りが減った」「テストの分量がちょうどよかった」etc...
    - ネガティブな意見はなかった（！）
  - 筆者・チーム共に、単体テストの目的は達成できていることを実感している
  - また予期せぬ効果として、エラー時のUI実装漏れがかなり減った
    - テスト観点を考える時に、エラー時テストをよく書くために実装漏れがかなり減った
    - 手戻り観点で開発スピードには大きく貢献したように感じる
- まとめ
  - 目的の達成により、以下のような効果が得られたと考えられる
    - チームの開発体験の満足度向上
      - 開発体験の満足度が高い≒効率的・生産的な開発が実現できている
    - チームの開発スピード向上
      - 遅延リスク回避
      - 初期から一定の速度で開発し続けられていることから、プロジェクト全体で見ても早まったのでは？
        - 定量的なエビデンスは当然ないので、定性評価
          - （そもそも定量的に測るには全く同じスキルセットを持ったメンバー複数チームで同時に同じプロジェクトをやらないとわからない）
          - そこらへんの統計的データが気になる方はLeanとDevopsの科学を参照されたし
  - 一方、細かい点ではまだブラッシュアップの余地があるとも感じてる
    - プロジェクト規模にもよるし、チームメンバーのスキルにもよるので、まだまだ一概には言えない部分が多い
  - 今後も同様の活動を続けて、より良いテストの文化を多くのチームに根付かせていきたい

---
title: "チーム開発を加速するフロントエンドのテスト戦略"
emoji: "⛳"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["test", "jest"]
published: false
---

みなさんはテスト書いてますか？「時間がなくて書いてない」「書き方がわからない」「何をテストすべきかわからない」など、テストを書いてないチームには色々理由があると思います。テスティングフレームワークの選定や使い方を学ぶのは重要ですが、それ以上に目的や戦略を学ぶことが重要です。前任者たちの説くテストの目的を学び、プロダクトに合ったテスト戦略を自分で考えなければ、テストは形骸化するかプロジェクトの足を引っ張るだけになります。単調で振る舞いのほとんどないサイトなら、テストはいらないかもしれません。Webアプリケーションと呼ばれるものの開発に携わっているなら、多くの場合テストは開発スピードを促進・維持する飛び道具になり得ます。本稿は筆者が取り組んで実際に高いチーム満足度と速度を得られた、テスト戦略についてまとめたものです。

## テストの目的を考える

まずはテストの目的を考えてみます。

:::message
本稿で言うテストは、自動テストのことです。
:::

プロジェクトの代償関係なく、開発を遅延させる要素はなんでしょう？

- 要件や実装時の考慮漏れや齟齬による追加修正
- 多発する要件の変更
- 変更に伴い発生するリグレッションバグ
- 積み重ねた実装が生む高い認知不可

他にも色々考えられますが、代表的なのはこの辺ではないでしょうか？上記に挙げた要素はよくある開発を遅延させる要素だと筆者は考えていますが、同時にこれらはテストによってカバーできるものだと考えています。ここで重要なのが、**カバーできる**のであって必ずしも**カバーされる**ものではないと言うことです。言い換えると、「正しくテストを運用できれば」と言うことです。正しくテストを運用できればこれらの要因での遅延を防ぐことができるのです。

**テストの目的は開発を遅延させないこと**です。テストを書くことが目的ではありません。テストを書くことは、目的を達成するための手段の一つです。テストを書くことが目的になってしまうと、むしろ無駄なテストの記述に時間がかかり、開発を遅延させたりします。

### テストが効果的なプロジェクト

テストで開発遅延を防げるかどうかは、プロジェクト特性にもよります。フロントエンドで言うと、振る舞いのほぼないランディングページを量産するプロジェクトにおいてはテストを書いてもあまり役に立たないかもしれません。極めてシンプルなアプリケーション、よくサンプルで作られるTodoアプリレベルだったらこれもまた役に立たないかもしれません。

一方でいわゆるWebアプリケーションとよばれるものの多くでは、テストは非常に有用になり得ます。そういった意見は世に溢れており、筆者自身の経験からもそう確信しています。

### テストの難しさ

正しくテストを運用するには、相応の知識とスキルが必要になってきます。チーム開発で知識やスキルを共有するのは、それ自体、なかなか難しいものです。

- ドキュメントに書いても、読まれない
- 読んでも理解できない
- 理解できても使えない
- 使えるけど応用できない

これらを越えてようやく、知識とスキルの共有がなされた状態と言えることでしょう。知識とスキルの共有は、本当に難しいことです。ではどうすればチーム開発でテストを正しく運用できるのでしょう？

ここからが、戦略の話になります。


- テストを文化にする戦略
  - 目的に沿ったテストを書くには以下がポイントになってくる
    - 達成したいことの共有
    - 考えるべきポイントを絞る
      - 外部依存の扱い方
      - 書き方や粒度
      - 共通化
    - 相談・議論の場を整える
  - 筆者はこの順番で目的に沿ったテストを実現しようと考えた
- step1: 達成したいことの共有
- step2: 考えるべきポイントを絞る
- step3: 相談・議論の場を整える
- 結果
  - 実際この1年2チームで↑をやってみた
  - 個人的にはかなり効果を感じた
  - 筆者だけが感じてもしょうがないので、匿名アンケートで忌憚なき意見を募集してみた
    - テストのことに限らず、技術選定や進め方など多くの項目について聞いてみた
    - 全体的に耳が痛い話もあったし、それなりに本音で回答してもらえたと思う
  - その中でもテストについては、全体的にかなり好評だった
    - チーム満足度が高かった
    - 「テストに助けられた」「苦手意識がなくなった」「目的がはっきりして迷わなくなった」「見通しがよくなった」「手戻りが減った」「テストの分量がちょうどよかった」etc...
    - ネガティブな意見はなかった（！）
  - 筆者・チーム共に、単体テストの目的は達成できていることを実感している
  - また予期せぬ効果として、エラー時のUI実装漏れがかなり減った
    - テスト観点を考える時に、エラー時テストをよく書くために実装漏れがかなり減った
    - 手戻り観点で開発スピードには大きく貢献したように感じる
- まとめ
  - 目的の達成により、以下のような効果が得られたと考えられる
    - チームの開発体験の満足度向上
      - 開発体験の満足度が高い≒効率的・生産的な開発が実現できている
    - チームの開発スピード向上
      - 遅延リスク回避
      - 初期から一定の速度で開発し続けられていることから、プロジェクト全体で見ても早まったのでは？
        - 定量的なエビデンスは当然ないので、定性評価
          - （そもそも定量的に測るには全く同じスキルセットを持ったメンバー複数チームで同時に同じプロジェクトをやらないとわからない）
          - そこらへんの統計的データが気になる方はLeanとDevopsの科学を参照されたし
  - 一方、細かい点ではまだブラッシュアップの余地があるとも感じてる
    - プロジェクト規模にもよるし、チームメンバーのスキルにもよるので、まだまだ一概には言えない部分が多い
  - 今後も同様の活動を続けて、より良いテストの文化を多くのチームに根付かせていきたい
